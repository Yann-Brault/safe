#!/bin/sh

TARGET=merged.js
REV_JSON=`echo $TARGET | sed 's/\(.*\).js/\1_jalangi_.json/'`
REV_JS=`echo $TARGET | sed 's/\(.*\).js/\1_jalangi_.js/'`

echo "Generating $REV_JSON and $REV_JS..."
node $JALANGI_HOME/src/js/commands/esnstrument_cli.js --inlineIID --inlineSource $TARGET

echo "Generating cfgSpanInfo.json..."
$SAFE_HOME/bin/safe cfgSpanInfo -cfgSpanInfo:out=cfgSpanInfo.json $TARGET

echo "Generating iidMap.json and iidToLocation.json... @ $DS_HOME"
node $DS_HOME/IID2CFGSpan.js $REV_JSON cfgSpanInfo.json

echo "Generating function.json ... @ $DS_HOME"
node $DS_HOME/instrument.js $REV_JS

echo "Generating direct_vanilla.js... @ $DS_HOME"
node $JALANGI_HOME/generate_direct_vanilla.js --analysis src/js/sample_analyses/ChainedAnalyses.js --analysis src/js/sample_analyses/dlint/DynamicShortcut.js $DS_HOME/engine.js
