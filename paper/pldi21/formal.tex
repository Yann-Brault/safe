\section{Formalization}

In this section, we formally define the dynamic shortcut over the abstract
interpretation.


\subsection{Concrete Semantics}
\[
  \prog ::= (\lab: \inst)^*\\
\]
A program $\prog$ is a sequence of labelled instructions.  We represent the
semantics of a program $\prog$ as a state transition system $(\stset, \trans,
\istset)$.  A state $\st \in \stset = \labset \times \memset$ is a pair of a
label and a memory and represents a status of the program $\prog$.  A memory
$\mem \in \memset = \locset \finmap \valset$ is a finite mapping from locations
to values. A program starts with an initial state in $\istset$.  The transition
relation $\trans \subseteq \stset \times \stset$ describes how states are
transformed to other states.

A \textit{collecting semantics} $\sem{\prog} = \{ \st \in \stset \mid \ist \in
\istset \wedge \ist \trans^* \st \}$ consists of reachable states from initial
states of the program $\prog$.  We could calculate it using the \textit{transfer
function} $\transfer: \dom \rightarrow \dom$ as follows:
\[
  \sem{\prog} = \underset{n \rightarrow \infty}{\lim}{\transfer^n(\ielem)}\\
  \qquad
  \transfer(\elem) = \elem \join \step(\elem)\\
\]
The \textit{concrete domain} $\dom = \powerset{\stset}$ is a complete lattice
with $\cup$, $\cap$, and $\subseteq$ as its join($\join$), meet($\meet$), and
partial order($\order$) operators.  The initial states are $\ielem = \istset$.
The \textit{one-step execution} $\step: \dom \rightarrow \dom$ transforms states
using the transition relation $\trans$: $\step(\elem) = \{ \st' \mid \st \in
\elem \wedge \st \trans \st' \}$.


\subsection{Abstract Interpretation}
The abstract interpretation over-approximate the transfer $\transfer$ to the
\textit{abstract transfer function} $\abstransfer: \absdom \rightarrow \absdom$
to get the \textit{abstract semantics} $\abssem{\prog}$ in finite iterations as
follows:
\[
    \abssem{\prog} = \underset{n \rightarrow
    \infty}{\lim}{(\abstransfer)^n(\iabselem)}\\
\]
We define a \textit{state abstraction} $\dom \galois{\alpha}{\gamma} \absdom$ as
a Galois connection between the concrete domain $\dom$ and an abstract domain
$\absdom$ with a \textit{concretization function} $\gamma$ and a
\textit{abstraction function} $\alpha$.  The initial abstract state $\iabselem
\in \absdom$ represents an abstraction of the initial state set; $\ielem
\subseteq \gamma(\iabselem)$.  The abstract transfer function $\abstransfer:
\absdom \rightarrow \absdom$ is defined as $\abstransfer(\abselem) = \abselem
\join \absstep(\abselem)$ with an \textit{abstract one-step execution}
$\absstep: \absdom \rightarrow \absdom$.  For the sound state abstraction, the
join operator and the abstract one-step execution should satisfy the following
conditions:
\begin{itemize}
  \item $\forall \abselem_0, \abselem_1 \in \absdom. \; \gamma(\abselem_0) \cup
    \gamma(\abselem_1) \subseteq \gamma(\abselem_0 \join \abselem_1)$
  \item $\forall \abselem \in \absdom. \; \absstep \circ \gamma(\abselem) \subseteq
    \gamma \circ \absstep(\abselem)$
\end{itemize}


\subsection{Analysis Sensitivity}

Abstract interpretation is often defined with \textit{analysis sensitivity} to
increase the precision of static analysis.  A sensitive abstract domain
$\sabsdom: \viewset \rightarrow \absdom$ is defined with a \textit{view
abstraction} $\viewmap: \viewset \rightarrow \dom$ that provides multiple points
of views for reachable states during static analysis.  It maps a finite number
of views $\viewset$ to sets of states $\dom$. Each view $\view \in \viewset$
represents a set of states $\viewmap(\view)$.
A \textit{sensitive state abstraction} $\dom
\galois{\alpha_\viewmap}{\gamma_\viewmap} \sabsdom$ is a Galois connection between
the concrete domain $\dom$ and the sensitive abstract domain $\sabsdom$ with the
following concretization function:
\[
  \gamma_\viewmap(\abselem) = \{ \st \in \stset \mid \forall \view \in \viewset.
  \; \st \in \viewmap(\view) \Rightarrow \st \in \gamma \circ \sabselem(\view) \}
\]

With analysis sensitivities, the abstract one-step execution $\sabsstep:
\sabsdom \rightarrow \sabsdom$ is defined as follows:
\[
  \sabsstep(\sabselem) = \lambda \view \in \viewset. \; \underset{\view' \in
  \viewset}{\bigjoin}{\viewtrans{\view'}{\view} \circ \sabselem(\view')}
\]
where $\viewtrans{\view'}{\view}: \absdom \rightarrow \absdom$ is the abstract
semantics of a \textit{view transition} from a view $\view'$ to another view
$\view$.  It should satsify the following condition for the soundness of the
analysis:
\[
  \forall \abselem \in \absdom. \; \step(\gamma(\abselem) \cap \viewmap(\view'))
  \cap \viewmap(\view) \subseteq \gamma \circ
  \viewtrans{\view'}{\view}(\abselem)
\]

One of the most widely-used sensitivity techniques is \textit{flow sensitivity}
using a flow sensitive view abstraction $\fsviewmap: \labset \rightarrow \dom$.
It discriminates states using their labels as follows:
\[
  \forall \lab \in \labset. \; \fsviewmap(\lab) = \{ \st \in \stset \mid \st =
  (\lab, \_) \}
\]


\subsection{Abstract Counting}

We define a \textit{memory abstraction} $\powerset{\memset}
\galois{\alpha_\memset}{\gamma_\memset} \absmemset$ as a Galois connection
between sets of concrete memories and abstract memories.  An abstract memory
$\absmem \in \absmemset: \abslocset \finmap \absvalset$ is a finite mapping from
abstract locations to abstract values.  The \textit{strong update} in memory
abstraction is important to increase the precision of static analysis.  For
sound analysis, a memory update for a specific abstract location should join old
abstract values with new abstract values, called as a \textit{weak update}.
It degrades the analysis precision because of the sprious values.  To overcome
such degradation, researchers proposed the abstract
counting~\cite{abstract-gc-counting, revisit-recency} to track how many times an
abstract location has been allocated and to apply strong updates to singleton
abstract locations.

We extend abstract states with an abstract counting operator $\abscount{-}:
\abslocset \rightarrow \abscountset = \{ \abszero, \absone, \absmany \}$, which
is a function that takes an abstract location and returns its abstract count;
$\abszero$ denotes that it have never been allocated, $\absone$ once, and
$\absmany$ more than or equals to twice.


\subsection{Lazy Concrete Interpretation}

We define a \textit{lazy concrete interpretation} by extending the transition
relation $\trans$ as a symbolic transition relation $\symbtrans$ on abstract
states. First, we extends the concrete states $\stset$ to \textit{symbolic
states} $\symbstset = (\labset \times \symbmemset) \cup \{ \excst \}$ with
symbolic memories $\symbmemset$ consisting of symbolic values $\symb \in
\symbset$ and a special exception state $\excst$. Each symbolic value denotes an
abstract value cannot be concretized to a singleton value.  A symbolic state
\textit{alwyas} has a symbolic transition relation with a single symbolic state.
When a symbolic state has a non-determinism or accesses symbolic values, it has
the relation with the exception state: $\symbst \symbtrans \excst$.  Thus, the lazy
concrete interpretation does not care about the non-deterministic semantics or
symbolic values.

We define a Galois connection $\symbstset
\galois{\alpha_\symbset}{\gamma_\symbset} \absdom$ to freely convert an abstract
state to the corresponding symbolic state and vice versa.  In the concretization
function $\gamma_\symbset$, if an abstract value $\absval$ represents a
singleton value, the function transforms the abstract value to the
corresponding concrete value.  Otherwise, it keeps the abstract value as a
symbolic value in the result symbolic state.


\subsection{Combined Analysis}

We define the \textit{combined analysis} of the abstract interpretation and the
lazy concrete interpretation by extending the view transition as follows:
\[
  \viewtrans{\view'}{\view}_\symbset(\abselem) = \left\{
    \begin{array}{ll}
      \abselem_0 & \text{if} \; \symbst' \symbtrans \excst\\
      \alpha_\symbset(\symbst) & \text{if} \; \symbst' \symbtrans \symbst
      \wedge\\
      & \phantom{\text{if}} \; \gamma \circ \alpha_\symbset(\symbst)
      \cap \viewmap(\view) \neq \varnothing\\ \bot & \text{otherwise}\\
    \end{array}
  \right.
\]
where $\symbst' = \gamma_\symbset \circ \abselem(\view')$ and $\abselem_0 =
\viewtrans{\view'}{\view}(\abselem)$.  The combined analysis first tries to
convert the current abstract state $\abselem(\view')$ to the corresponding
symbolic state $\symbst'$ and performs the lazy concrete evaluation.  When the
evaluation produces the exception state $\excst$, it utilizes the abstract
interpretation instead of the lazy concrete interpretation.  Otherwise, the lazy
concrete interpretation successfully produces a new symbolic state $\symbst$.
If the symbolic state $\symbst$ is related to the target view $\view$, the
result is the corresponding abstract state $\alpha_\symbset(\symbst)$ of the
symbolic state $\symbst$. Otherwise, the result becomes the bottom $\bot$.
