#!/bin/bash

TARGET="target.js"

for i in "$@"
do
case $i in
  -w|--wrapped)
    WRAPPED=true
    shift
  ;;
  --target=*)
    TARGET="${i#*=}"
    shift
  ;;
  -*)
    shift
  ;;
esac
done

LODASH=$SAFE_HOME/tests/benchmarks/lodash4

echo > $TARGET
if [ $WRAPPED ]; then
  echo "(function() {" >> $TARGET
fi

cat $LODASH/setting.js $LODASH/lodash.js $LODASH/test-setting.js >> $TARGET
if [[ ! "$#" -eq 0 ]]; then
  cat $@ >> $TARGET
fi

if [ $WRAPPED ]; then
  echo "}.call(global));" >> $TARGET
fi
node $DS_HOME/parenthesize.js $TARGET $TARGET
